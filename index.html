<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Financeiro - Grupo de Oração</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        gold: {
                            50: '#fdf9f0',
                            100: '#fbf0d9',
                            200: '#f6e0b3',
                            300: '#edc67a',
                            400: '#e3a947',
                            500: '#d4902a',
                            600: '#b87620',
                            700: '#945c1d',
                            800: '#7a4d1e',
                            900: '#653f1b',
                        },
                        church: {
                            50: '#f0f4ff',
                            100: '#e0e7ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        .gradient-gold {
            background: linear-gradient(135deg, #d4902a 0%, #edc67a 50%, #d4902a 100%);
        }
        .gradient-church {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        .shake {
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #d4902a;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #b87620;
        }
        .login-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #1e40af 100%);
            position: relative;
            overflow: hidden;
        }
        .login-bg::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
        }
        .readonly-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fbbf24;
            color: #92400e;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .ano-tab {
            transition: all 0.3s ease;
        }
        .ano-tab.active {
            background: linear-gradient(135deg, #d4902a, #b87620);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(212, 144, 42, 0.3);
        }
        .ano-tab:not(.active):hover {
            background: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">

    <!-- TELA DE LOGIN -->
    <div id="loginScreen" class="fixed inset-0 login-bg flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden slide-in">
            <div class="bg-gradient-to-r from-church-800 to-church-600 p-8 text-center">
                <div class="w-20 h-20 rounded-full gradient-gold mx-auto flex items-center justify-center text-white text-3xl mb-4 shadow-lg">
                    <i class="fas fa-church"></i>
                </div>
                <h1 class="text-2xl font-serif font-bold text-white mb-2">Finanças</h1>
                <p class="text-church-100 text-sm">Grupo de Oração - Acesso Restrito</p>
            </div>
            
            <div class="p-8">
                <div id="loginError" class="hidden mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg text-sm flex items-center gap-2">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>Usuário ou senha incorretos!</span>
                </div>

                <!-- Área do Administrador -->
                <div class="mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                        <i class="fas fa-shield-alt text-gold-500"></i>
                        Acesso Administrativo
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <input type="text" id="loginUser" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-church-500 focus:border-church-500 text-sm" placeholder="Usuário">
                        </div>
                        <div class="relative">
                            <input type="password" id="loginPass" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-church-500 focus:border-church-500 text-sm" placeholder="Senha">
                            <button type="button" onclick="togglePassword()" class="absolute right-3 top-2.5 text-gray-400 hover:text-gray-600">
                                <i class="fas fa-eye text-sm" id="eyeIcon"></i>
                            </button>
                        </div>
                        <button onclick="fazerLoginAdmin()" class="w-full py-2 bg-church-600 text-white rounded-lg hover:bg-church-700 transition-colors text-sm font-medium">
                            Entrar como Administrador
                        </button>
                    </div>
                </div>

                <!-- Área do Visitante -->
                <div class="text-center">
                    <div class="relative mb-4">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-gray-200"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-2 bg-white text-gray-500">ou</span>
                        </div>
                    </div>
                    
                    <button onclick="fazerLoginVisitante()" class="w-full py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium flex items-center justify-center gap-2 border-2 border-dashed border-gray-300">
                        <i class="fas fa-eye text-blue-500"></i>
                        Entrar como Visitante
                    </button>
                    <p class="text-xs text-gray-500 mt-2">Apenas visualização, sem edição</p>
                </div>
            </div>
        </div>
    </div>

    <!-- BADGE MODO LEITURA -->
    <div id="readOnlyBadge" class="readonly-badge hidden">
        <i class="fas fa-eye mr-1"></i> Modo Visualização
    </div>

    <!-- Sidebar -->
    <div id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-church-900 text-white transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-40 shadow-2xl">
        <div class="p-6 border-b border-church-700">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full gradient-gold flex items-center justify-center text-white font-bold text-lg">
                    <i class="fas fa-church"></i>
                </div>
                <div>
                    <h1 class="font-serif text-lg font-bold">Finanças</h1>
                    <p class="text-xs text-gray-300">Grupo de Oração</p>
                </div>
            </div>
            <div class="mt-4 flex items-center gap-2 text-xs text-gray-300 bg-church-800 rounded-lg p-2">
                <i class="fas fa-user-circle"></i>
                <span id="userDisplay">Usuário</span>
                <span id="roleDisplay" class="ml-auto px-2 py-0.5 rounded-full bg-gold-500 text-white text-[10px] font-bold">ADMIN</span>
            </div>
        </div>
        
        <nav class="p-4 space-y-2">
            <button onclick="showSection('dashboard')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-church-800 transition-colors text-left bg-church-800">
                <i class="fas fa-chart-line w-5"></i>
                <span>Dashboard</span>
            </button>
            <button onclick="showSection('membros')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-church-800 transition-colors text-left">
                <i class="fas fa-users w-5"></i>
                <span>Mensalidades</span>
            </button>
            <button onclick="showSection('entradas')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-church-800 transition-colors text-left">
                <i class="fas fa-arrow-down text-green-400 w-5"></i>
                <span>Entradas</span>
            </button>
            <button onclick="showSection('saidas')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-church-800 transition-colors text-left">
                <i class="fas fa-arrow-up text-red-400 w-5"></i>
                <span>Saídas</span>
            </button>
            <button onclick="showSection('relatorios')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-church-800 transition-colors text-left">
                <i class="fas fa-file-alt w-5"></i>
                <span>Relatórios</span>
            </button>
        </nav>

        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-church-700 space-y-2">
            <div class="bg-church-800 rounded-lg p-3">
                <p class="text-xs text-gray-300 mb-1">Saldo Atual</p>
                <p class="text-xl font-bold text-gold-300" id="sidebarSaldo">R$ 0,00</p>
            </div>
            <button onclick="fazerLogout()" class="w-full flex items-center gap-2 px-4 py-2 bg-red-600/20 text-red-300 rounded-lg hover:bg-red-600/30 transition-colors text-sm">
                <i class="fas fa-sign-out-alt"></i>
                Sair do Sistema
            </button>
        </div>
    </div>

    <!-- Mobile Menu Button -->
    <button onclick="toggleSidebar()" class="md:hidden fixed top-4 left-4 z-30 bg-church-900 text-white p-3 rounded-lg shadow-lg">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Main Content -->
    <div class="md:ml-64 min-h-screen">
        
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-30">
            <div class="px-6 py-4 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-serif font-bold text-gray-800" id="pageTitle">Dashboard</h2>
                    <p class="text-sm text-gray-500" id="currentDate"></p>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="backupData()" class="admin-only hidden sm:flex items-center gap-2 px-4 py-2 bg-gold-100 text-gold-700 rounded-lg hover:bg-gold-200 transition-colors text-sm font-medium">
                        <i class="fas fa-download"></i>
                        Backup
                    </button>
                    <label class="admin-only hidden sm:flex items-center gap-2 px-4 py-2 bg-church-100 text-church-700 rounded-lg hover:bg-church-200 transition-colors text-sm font-medium cursor-pointer">
                        <i class="fas fa-upload"></i>
                        Restaurar
                        <input type="file" id="restoreFile" class="hidden" accept=".json" onchange="restoreData(this)">
                    </label>
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-gold-400 to-gold-600 flex items-center justify-center text-white font-bold shadow-lg">
                        CF
                    </div>
                </div>
            </div>
        </header>

        <!-- Content Sections -->
        <main class="p-6 space-y-6">

            <!-- DASHBOARD SECTION -->
            <section id="dashboard" class="section-content fade-in">
                <div id="viewerAlert" class="hidden mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-3">
                    <i class="fas fa-info-circle text-blue-500 mt-0.5"></i>
                    <div>
                        <h4 class="font-medium text-blue-900">Modo Visualização Ativo</h4>
                        <p class="text-sm text-blue-700 mt-1">Você está acessando como visitante. Entre como administrador para editar dados.</p>
                    </div>
                </div>

                <!-- Cards Resumo -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 card-hover">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-sm text-gray-500 font-medium">Saldo Atual</p>
                                <h3 class="text-2xl font-bold text-gray-800 mt-1" id="cardSaldo">R$ 0,00</h3>
                            </div>
                            <div class="w-12 h-12 rounded-lg bg-church-100 flex items-center justify-center text-church-600">
                                <i class="fas fa-wallet text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 card-hover">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-sm text-gray-500 font-medium">Entradas (Mês)</p>
                                <h3 class="text-2xl font-bold text-green-600 mt-1" id="cardEntradas">R$ 0,00</h3>
                            </div>
                            <div class="w-12 h-12 rounded-lg bg-green-100 flex items-center justify-center text-green-600">
                                <i class="fas fa-arrow-down text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 card-hover">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-sm text-gray-500 font-medium">Saídas (Mês)</p>
                                <h3 class="text-2xl font-bold text-red-600 mt-1" id="cardSaidas">R$ 0,00</h3>
                            </div>
                            <div class="w-12 h-12 rounded-lg bg-red-100 flex items-center justify-center text-red-600">
                                <i class="fas fa-arrow-up text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 card-hover">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-sm text-gray-500 font-medium">Mensalidades</p>
                                <h3 class="text-2xl font-bold text-gold-600 mt-1" id="cardMensalidades">0/0</h3>
                            </div>
                            <div class="w-12 h-12 rounded-lg bg-gold-100 flex items-center justify-center text-gold-600">
                                <i class="fas fa-users text-xl"></i>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div class="bg-gold-500 h-2 rounded-full" id="barMensalidades" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Gráfico e Últimas Transações -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="font-serif text-lg font-bold text-gray-800 mb-4">Fluxo Financeiro - Últimos 6 Meses</h3>
                        <canvas id="financeChart" width="400" height="200"></canvas>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="font-serif text-lg font-bold text-gray-800 mb-4">Últimas Transações</h3>
                        <div class="space-y-3 max-h-96 overflow-y-auto" id="ultimasTransacoes">
                            <!-- Preenchido via JS -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- MEMBROS SECTION -->
            <section id="membros" class="section-content hidden fade-in">
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b border-gray-100 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h3 class="font-serif text-lg font-bold text-gray-800">Controle de Mensalidades</h3>
                            <p class="text-sm text-gray-500">Gerencie os pagamentos mensais dos membros</p>
                        </div>
                        <button onclick="openModal('membro')" class="admin-only px-4 py-2 bg-church-600 text-white rounded-lg hover:bg-church-700 transition-colors flex items-center gap-2">
                            <i class="fas fa-plus"></i>
                            Novo Membro
                        </button>
                    </div>
                    
                    <!-- Abas de Ano para Mensalidades -->
                    <div class="px-6 py-3 bg-gray-50 border-b border-gray-100">
                        <div class="flex gap-2 overflow-x-auto" id="abasAnosMembros">
                            <!-- Preenchido via JS -->
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b border-gray-100">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Membro</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Jan</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Fev</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Mar</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Abr</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Mai</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Jun</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Jul</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Ago</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Set</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Out</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Nov</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Dez</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Total</th>
                                    <th class="px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider admin-only">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaMembros" class="divide-y divide-gray-100">
                                <!-- Preenchido via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ENTRADAS SECTION -->
            <section id="entradas" class="section-content hidden fade-in">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                            <div class="p-6 border-b border-gray-100 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                                <div>
                                    <h3 class="font-serif text-lg font-bold text-gray-800">Histórico de Entradas</h3>
                                    <p class="text-sm text-gray-500">Coletas, doações e rendimentos</p>
                                </div>
                                <button onclick="openModal('entrada')" class="admin-only px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
                                    <i class="fas fa-plus"></i>
                                    Nova Entrada
                                </button>
                            </div>
                            
                            <!-- Abas de Ano -->
                            <div class="px-6 py-3 bg-gray-50 border-b border-gray-100">
                                <div class="flex gap-2 overflow-x-auto" id="abasAnosEntradas">
                                    <!-- Preenchido via JS -->
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50 border-b border-gray-100">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Data</th>
                                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Descrição</th>
                                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Categoria</th>
                                            <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase">Valor</th>
                                            <th class="px-6 py-3 text-center text-xs font-semibold text-gray-500 uppercase admin-only">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabelaEntradas" class="divide-y divide-gray-100">
                                        <!-- Preenchido via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                            <h3 class="font-serif text-lg font-bold text-gray-800 mb-4">Resumo por Categoria</h3>
                            <div id="resumoEntradas" class="space-y-3">
                                <!-- Preenchido via JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SAÍDAS SECTION -->
            <section id="saidas" class="section-content hidden fade-in">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                            <div class="p-6 border-b border-gray-100 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                                <div>
                                    <h3 class="font-serif text-lg font-bold text-gray-800">Histórico de Saídas</h3>
                                    <p class="text-sm text-gray-500">Pagamentos e despesas</p>
                                </div>
                                <button onclick="openModal('saida')" class="admin-only px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2">
                                    <i class="fas fa-plus"></i>
                                    Nova Saída
                                </button>
                            </div>
                            
                            <!-- Abas de Ano -->
                            <div class="px-6 py-3 bg-gray-50 border-b border-gray-100">
                                <div class="flex gap-2 overflow-x-auto" id="abasAnosSaidas">
                                    <!-- Preenchido via JS -->
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50 border-b border-gray-100">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Data</th>
                                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Descrição</th>
                                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Categoria</th>
                                            <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase">Valor</th>
                                            <th class="px-6 py-3 text-center text-xs font-semibold text-gray-500 uppercase admin-only">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabelaSaidas" class="divide-y divide-gray-100">
                                        <!-- Preenchido via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                            <h3 class="font-serif text-lg font-bold text-gray-800 mb-4">Resumo por Categoria</h3>
                            <div id="resumoSaidas" class="space-y-3">
                                <!-- Preenchido via JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- RELATÓRIOS SECTION -->
            <section id="relatorios" class="section-content hidden fade-in">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="font-serif text-lg font-bold text-gray-800 mb-4">Exportar Dados</h3>
                        <div class="space-y-3">
                            <button onclick="exportarExcel()" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-file-excel"></i>
                                Exportar para Excel
                            </button>
                            <button onclick="exportarPDF()" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                <i class="fas fa-file-pdf"></i>
                                Exportar Relatório PDF
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="font-serif text-lg font-bold text-gray-800 mb-4">Filtros</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Mês</label>
                                <select id="filtroMes" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-church-500 focus:border-church-500">
                                    <option value="todos">Todos</option>
                                    <option value="0">Janeiro</option>
                                    <option value="1">Fevereiro</option>
                                    <option value="2">Março</option>
                                    <option value="3">Abril</option>
                                    <option value="4">Maio</option>
                                    <option value="5">Junho</option>
                                    <option value="6">Julho</option>
                                    <option value="7">Agosto</option>
                                    <option value="8">Setembro</option>
                                    <option value="9">Outubro</option>
                                    <option value="10">Novembro</option>
                                    <option value="11">Dezembro</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ano</label>
                                <select id="filtroAno" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-church-500 focus:border-church-500">
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="aplicarFiltro()" class="mt-3 w-full px-4 py-2 bg-church-600 text-white rounded-lg hover:bg-church-700 transition-colors">
                            Aplicar Filtro
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="font-serif text-lg font-bold text-gray-800 mb-4">Balanço Anual</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b border-gray-100">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Mês</th>
                                    <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase">Entradas</th>
                                    <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase">Saídas</th>
                                    <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase">Saldo</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaBalanco" class="divide-y divide-gray-100">
                                <!-- Preenchido via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto slide-in">
            <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                <h3 class="font-serif text-lg font-bold text-gray-800" id="modalTitle">Novo Registro</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6" id="modalContent">
                <!-- Conteúdo dinâmico -->
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 transition-transform duration-300 z-50 flex items-center gap-2">
        <i class="fas fa-check-circle text-green-400"></i>
        <span id="toastMessage">Operação realizada com sucesso!</span>
    </div>

    <script>
        // SISTEMA DE AUTENTICAÇÃO
        const USUARIOS = {
            'admin': { 
                senha: 'Rcc2025!', 
                nome: 'Coordenador', 
                role: 'admin'
            }
        };

        let usuarioAtual = null;
        let sessionTimeout = null;
        let anoAtualEntradas = new Date().getFullYear();
        let anoAtualSaidas = new Date().getFullYear();
        let anoAtualMembros = new Date().getFullYear();

        // Dados iniciais com estrutura de anos
        let dados = {
            membros: [
                { id: 1, nome: 'CLAIR', pagamentos: { 2025: { 10: 15, 11: 15 } } },
                { id: 2, nome: 'FRANCISCO', pagamentos: { 2025: { 10: 15, 11: 15 } } },
                { id: 3, nome: 'GERALDO', pagamentos: { 2025: { 7: 15, 8: 15, 9: 15, 10: 5 } } },
                { id: 4, nome: 'LEONICE', pagamentos: { 2025: { 9: 10, 10: 15, 11: 15 } } },
                { id: 5, nome: 'LEOZELIA', pagamentos: { 2025: { 10: 15, 11: 15 } } },
                { id: 6, nome: 'MARIA REGIANE KLIP', pagamentos: { 2025: { 5: 10, 6: 10, 7: 10, 8: 10, 9: 10, 10: 10, 11: 10 } } },
                { id: 7, nome: 'MIGUEL PALCZUK', pagamentos: { 2025: { 7: 15, 8: 15, 9: 15, 10: 15, 11: 10 } } },
                { id: 8, nome: 'ROSANE BERNARDINO', pagamentos: { 2025: {} } },
                { id: 9, nome: 'ROSENI OLIVEIRA', pagamentos: { 2025: { 7: 10, 8: 10, 9: 10, 10: 10, 11: 10 } } },
                { id: 10, nome: 'TEREZINHA AP. A. KWASNEY', pagamentos: { 2025: { 10: 15, 11: 15 } } },
                { id: 11, nome: 'MARIA VERACY BATISTA MOREIRA', pagamentos: { 2025: { 9: 10, 10: 10 } } },
                { id: 12, nome: 'NERCI TEREZINHA', pagamentos: { 2025: {} } },
                { id: 13, nome: 'LOURIVAL LAERCIO LENZ', pagamentos: { 2025: { 10: 10, 11: 10 } } },
                { id: 14, nome: 'CLEUSA LENZ', pagamentos: { 2025: { 10: 10, 11: 10 } } },
                { id: 15, nome: 'CAROLINE K. CARNEIRO', pagamentos: { 2025: { 0: 'X', 1: 'X', 2: 'X', 3: 'X', 4: 'X', 5: 'X', 7: 10, 8: 10, 9: 10, 10: 10 } } },
                { id: 16, nome: 'GABRIELA K. CARNEIRO', pagamentos: { 2025: { 0: 'X', 1: 'X', 2: 'X', 3: 'X', 4: 'X', 5: 'X', 7: 10, 8: 10, 9: 10, 10: 10 } } },
                { id: 17, nome: 'VINICIUS', pagamentos: { 2025: { 0: 'X', 7: 10, 8: 10, 9: 10, 10: 10, 11: 10 } } },
                { id: 18, nome: 'SUELEN', pagamentos: { 2025: { 0: 'X', 7: 10, 8: 10, 9: 10, 10: 10, 11: 10 } } },
                { id: 19, nome: 'JEMERSON DANIEL RIBAS', pagamentos: { 2025: { 0: 'X', 1: 'X', 2: 'X', 3: 'X', 4: 'X', 5: 'X', 6: 'X', 7: 'X', 9: 15, 10: 15 } } }
            ],
            entradas: [
                { id: 1, data: '2025-10-16', descricao: 'Coleta', categoria: 'Coleta', valor: 6, ano: 2025 },
                { id: 2, data: '2025-10-23', descricao: 'Coleta', categoria: 'Coleta', valor: 19, ano: 2025 },
                { id: 3, data: '2025-10-30', descricao: 'Coleta', categoria: 'Coleta', valor: 10, ano: 2025 },
                { id: 4, data: '2025-11-06', descricao: 'Coleta', categoria: 'Coleta', valor: 21, ano: 2025 },
                { id: 5, data: '2025-11-13', descricao: 'Coleta', categoria: 'Coleta', valor: 67, ano: 2025 },
                { id: 6, data: '2025-11-27', descricao: 'Coleta', categoria: 'Coleta', valor: 2, ano: 2025 },
                { id: 7, data: '2025-12-04', descricao: 'Coleta', categoria: 'Coleta', valor: 30, ano: 2025 },
                { id: 8, data: '2025-11-01', descricao: 'Rendimento Poupança', categoria: 'Rendimento', valor: 6.08, ano: 2025 },
                { id: 9, data: '2025-12-01', descricao: 'Rendimento Poupança', categoria: 'Rendimento', valor: 0.9, ano: 2025 },
                { id: 10, data: '2025-12-01', descricao: 'Rendimento Poupança', categoria: 'Rendimento', valor: 0.55, ano: 2025 },
                { id: 11, data: '2025-12-01', descricao: 'Rendimento Poupança', categoria: 'Rendimento', valor: 0.27, ano: 2025 },
                { id: 12, data: '2025-12-01', descricao: 'Rendimento Poupança', categoria: 'Rendimento', valor: 0.2, ano: 2025 }
            ],
            saidas: [
                { id: 1, data: '2025-10-22', descricao: 'A menos na transferência PIX - Clair', categoria: 'Ajuste', valor: 50, ano: 2025 },
                { id: 2, data: '2025-11-01', descricao: 'Mensalidade RCC Nov - PIX', categoria: 'Mensalidade', valor: 100, ano: 2025 },
                { id: 3, data: '2025-11-01', descricao: 'Pagamento Velas Paróquia - Clair', categoria: 'Compra', valor: 50, ano: 2025 },
                { id: 4, data: '2025-11-01', descricao: 'Mimo Servos Clair', categoria: 'Doação', valor: 33, ano: 2025 },
                { id: 5, data: '2025-11-01', descricao: 'Aporte Show Martin Valverde', categoria: 'Evento', valor: 60, ano: 2025 },
                { id: 6, data: '2025-11-01', descricao: 'Aquisição Controle Portão Igreja', categoria: 'Infraestrutura', valor: 70, ano: 2025 },
                { id: 7, data: '2025-11-04', descricao: 'Ajuda Custo Combustível Grupo Oração Pinhão', categoria: 'Ajuda', valor: 120, ano: 2025 },
                { id: 8, data: '2025-12-01', descricao: 'Pagamento Padre Erico - Clair', categoria: 'Doação', valor: 130, ano: 2025 },
                { id: 9, data: '2025-12-01', descricao: 'Cestas Crianças', categoria: 'Doação', valor: 60, ano: 2025 },
                { id: 10, data: '2025-12-01', descricao: 'Pagamento RCC Dez - PIX', categoria: 'Mensalidade', valor: 100, ano: 2025 }
            ],
            saldoInicial: 975.44
        };

        const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
        let currentSection = 'dashboard';

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            verificarSessao();
            carregarDados();
            atualizarData();
            
            document.addEventListener('mousemove', resetSessionTimeout);
            document.addEventListener('keypress', resetSessionTimeout);
        });

        function verificarSessao() {
            if (!usuarioAtual) {
                document.getElementById('loginScreen').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            } else {
                document.getElementById('loginScreen').classList.add('hidden');
                document.body.style.overflow = '';
            }
        }

        function fazerLoginAdmin() {
            const usuario = document.getElementById('loginUser').value.trim().toLowerCase();
            const senha = document.getElementById('loginPass').value;
            
            if (!usuario || !senha) {
                mostrarErroLogin('Preencha usuário e senha');
                return;
            }
            
            const userData = USUARIOS[usuario];
            
            if (userData && senha === userData.senha) {
                usuarioAtual = {
                    usuario: usuario,
                    nome: userData.nome,
                    role: userData.role,
                    loginTime: new Date().toISOString()
                };
                
                configurarPermissoes();
                document.getElementById('loginScreen').classList.add('hidden');
                document.body.style.overflow = '';
                
                document.getElementById('userDisplay').textContent = userData.nome;
                document.getElementById('roleDisplay').textContent = 'ADMIN';
                document.getElementById('roleDisplay').className = 'ml-auto px-2 py-0.5 rounded-full bg-gold-500 text-white text-[10px] font-bold';
                
                showToast(`Bem-vindo, ${userData.nome}!`);
                renderizarTudo();
                resetSessionTimeout();
                
            } else {
                mostrarErroLogin('Usuário ou senha incorretos');
                document.querySelector('.slide-in').classList.add('shake');
                setTimeout(() => {
                    document.querySelector('.slide-in').classList.remove('shake');
                }, 500);
            }
        }

        function fazerLoginVisitante() {
            usuarioAtual = {
                usuario: 'visitante',
                nome: 'Visitante',
                role: 'viewer',
                loginTime: new Date().toISOString()
            };
            
            configurarPermissoes();
            document.getElementById('loginScreen').classList.add('hidden');
            document.body.style.overflow = '';
            
            document.getElementById('userDisplay').textContent = 'Visitante';
            document.getElementById('roleDisplay').textContent = 'VISUALIZADOR';
            document.getElementById('roleDisplay').className = 'ml-auto px-2 py-0.5 rounded-full bg-blue-500 text-white text-[10px] font-bold';
            
            showToast('Bem-vindo! Modo visualização ativado.');
            renderizarTudo();
        }

        function mostrarErroLogin(msg) {
            const erro = document.getElementById('loginError');
            erro.querySelector('span').textContent = msg;
            erro.classList.remove('hidden');
            setTimeout(() => erro.classList.add('hidden'), 5000);
        }

        function configurarPermissoes() {
            const isAdmin = usuarioAtual.role === 'admin';
            
            document.querySelectorAll('.admin-only').forEach(el => {
                if (isAdmin) {
                    el.classList.remove('hidden');
                    el.disabled = false;
                } else {
                    el.classList.add('hidden');
                    el.disabled = true;
                }
            });
            
            if (!isAdmin) {
                document.getElementById('readOnlyBadge').classList.remove('hidden');
                document.getElementById('viewerAlert').classList.remove('hidden');
            } else {
                document.getElementById('readOnlyBadge').classList.add('hidden');
                document.getElementById('viewerAlert').classList.add('hidden');
            }
        }

        function fazerLogout() {
            if (confirm('Tem certeza que deseja sair do sistema?')) {
                usuarioAtual = null;
                clearTimeout(sessionTimeout);
                
                document.getElementById('loginUser').value = '';
                document.getElementById('loginPass').value = '';
                
                document.getElementById('loginScreen').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                
                showToast('Logout realizado com sucesso');
            }
        }

        function resetSessionTimeout() {
            if (sessionTimeout) clearTimeout(sessionTimeout);
            if (usuarioAtual) {
                sessionTimeout = setTimeout(() => {
                    alert('Sessão expirada por inatividade. Faça login novamente.');
                    fazerLogout();
                }, 30 * 60 * 1000);
            }
        }

        function togglePassword() {
            const input = document.getElementById('loginPass');
            const icon = document.getElementById('eyeIcon');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function atualizarData() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('pt-BR', options);
        }

        function carregarDados() {
            const salvos = localStorage.getItem('rcc_financeiro_dados_v2');
            if (salvos) {
                dados = JSON.parse(salvos);
                // Migrar dados antigos se necessário
                dados.membros.forEach(m => {
                    if (!m.pagamentos[2025]) {
                        m.pagamentos = { 2025: m.pagamentos };
                    }
                });
            } else {
                salvarDados();
            }
        }

        function salvarDados() {
            localStorage.setItem('rcc_financeiro_dados_v2', JSON.stringify(dados));
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('-translate-x-full');
        }

        function showSection(sectionName) {
            if (!usuarioAtual) return;
            
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            
            document.getElementById(sectionName).classList.remove('hidden');
            
            const titulos = {
                'dashboard': 'Dashboard',
                'membros': 'Controle de Mensalidades',
                'entradas': 'Entradas',
                'saidas': 'Saídas',
                'relatorios': 'Relatórios'
            };
            document.getElementById('pageTitle').textContent = titulos[sectionName];
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-church-800');
            });
            event.target.closest('.nav-btn').classList.add('bg-church-800');
            
            currentSection = sectionName;
            
            if (window.innerWidth < 768) {
                document.getElementById('sidebar').classList.add('-translate-x-full');
            }
            
            renderizarTudo();
        }

        function renderizarTudo() {
            if (!usuarioAtual) return;
            atualizarDashboard();
            renderizarAbasAnos();
            renderizarMembros();
            renderizarEntradas();
            renderizarSaidas();
            renderizarBalanco();
        }

        function obterAnosDisponiveis() {
            const anos = new Set([2025, 2026]);
            dados.entradas.forEach(e => anos.add(e.ano || new Date(e.data).getFullYear()));
            dados.saidas.forEach(s => anos.add(s.ano || new Date(s.data).getFullYear()));
            dados.membros.forEach(m => {
                Object.keys(m.pagamentos).forEach(ano => anos.add(parseInt(ano)));
            });
            return Array.from(anos).sort((a, b) => b - a);
        }

        function renderizarAbasAnos() {
            const anos = obterAnosDisponiveis();
            
            // Abas para Entradas
            const containerEntradas = document.getElementById('abasAnosEntradas');
            containerEntradas.innerHTML = anos.map(ano => `
                <button onclick="mudarAnoEntradas(${ano})" 
                        class="ano-tab px-4 py-2 rounded-lg text-sm font-medium ${ano === anoAtualEntradas ? 'active' : 'bg-white text-gray-600 border border-gray-200'}">
                    ${ano}
                </button>
            `).join('');
            
            // Abas para Saídas
            const containerSaidas = document.getElementById('abasAnosSaidas');
            containerSaidas.innerHTML = anos.map(ano => `
                <button onclick="mudarAnoSaidas(${ano})" 
                        class="ano-tab px-4 py-2 rounded-lg text-sm font-medium ${ano === anoAtualSaidas ? 'active' : 'bg-white text-gray-600 border border-gray-200'}">
                    ${ano}
                </button>
            `).join('');
            
            // Abas para Membros
            const containerMembros = document.getElementById('abasAnosMembros');
            containerMembros.innerHTML = anos.map(ano => `
                <button onclick="mudarAnoMembros(${ano})" 
                        class="ano-tab px-4 py-2 rounded-lg text-sm font-medium ${ano === anoAtualMembros ? 'active' : 'bg-white text-gray-600 border border-gray-200'}">
                    ${ano}
                </button>
            `).join('');
        }

        function mudarAnoEntradas(ano) {
            anoAtualEntradas = ano;
            renderizarAbasAnos();
            renderizarEntradas();
        }

        function mudarAnoSaidas(ano) {
            anoAtualSaidas = ano;
            renderizarAbasAnos();
            renderizarSaidas();
        }

        function mudarAnoMembros(ano) {
            anoAtualMembros = ano;
            renderizarAbasAnos();
            renderizarMembros();
        }

        function atualizarDashboard() {
            const totalEntradas = dados.entradas.reduce((acc, e) => acc + e.valor, 0);
            const totalSaidas = dados.saidas.reduce((acc, s) => acc + s.valor, 0);
            const saldo = dados.saldoInicial + totalEntradas - totalSaidas;
            
            document.getElementById('cardSaldo').textContent = formatarMoeda(saldo);
            document.getElementById('sidebarSaldo').textContent = formatarMoeda(saldo);
            
            const hoje = new Date();
            const mesAtual = hoje.getMonth();
            const anoAtual = hoje.getFullYear();
            
            // Calcular entradas do mês incluindo mensalidades
            let entradasMes = dados.entradas
                .filter(e => new Date(e.data).getMonth() === mesAtual && new Date(e.data).getFullYear() === anoAtual)
                .reduce((acc, e) => acc + e.valor, 0);
            
            // Adicionar mensalidades do mês como entrada
            const mensalidadesMes = calcularMensalidadesMes(mesAtual, anoAtual);
            entradasMes += mensalidadesMes;
            
            const saidasMes = dados.saidas
                .filter(s => new Date(s.data).getMonth() === mesAtual && new Date(s.data).getFullYear() === anoAtual)
                .reduce((acc, s) => acc + s.valor, 0);
            
            document.getElementById('cardEntradas').textContent = formatarMoeda(entradasMes);
            document.getElementById('cardSaidas').textContent = formatarMoeda(saidasMes);
            
            // Estatísticas de mensalidades
            let totalPagantes = 0;
            let totalDevido = 0;
            dados.membros.forEach(membro => {
                const pagamentosAno = membro.pagamentos[anoAtual] || {};
                const pagamento = pagamentosAno[mesAtual];
                if (pagamento && (pagamento === 'X' || pagamento > 0)) {
                    totalPagantes++;
                }
                totalDevido++;
            });
            
            document.getElementById('cardMensalidades').textContent = `${totalPagantes}/${totalDevido}`;
            const percentual = totalDevido > 0 ? (totalPagantes / totalDevido) * 100 : 0;
            document.getElementById('barMensalidades').style.width = `${percentual}%`;
            
            // Últimas transações incluindo mensalidades
            renderizarUltimasTransacoes(mesAtual, anoAtual);
            
            desenharGrafico();
        }

        function calcularMensalidadesMes(mes, ano) {
            let total = 0;
            dados.membros.forEach(membro => {
                const pagamentosAno = membro.pagamentos[ano] || {};
                const valor = pagamentosAno[mes];
                if (valor && valor !== 'X') {
                    total += parseFloat(valor) || 0;
                }
            });
            return total;
        }

        function renderizarUltimasTransacoes(mesAtual, anoAtual) {
            const transacoes = [];
            
            // Adicionar entradas normais
            dados.entradas.forEach(e => {
                transacoes.push({
                    tipo: 'entrada',
                    data: e.data,
                    descricao: e.descricao,
                    valor: e.valor,
                    categoria: e.categoria,
                    dataObj: new Date(e.data)
                });
            });
            
            // Adicionar saídas
            dados.saidas.forEach(s => {
                transacoes.push({
                    tipo: 'saida',
                    data: s.data,
                    descricao: s.descricao,
                    valor: s.valor,
                    categoria: s.categoria,
                    dataObj: new Date(s.data)
                });
            });
            
            // Adicionar mensalidades como transações de entrada
            dados.membros.forEach(membro => {
                Object.entries(membro.pagamentos).forEach(([ano, pagamentos]) => {
                    Object.entries(pagamentos).forEach(([mes, valor]) => {
                        if (valor && valor !== 'X') {
                            const dataPagamento = new Date(parseInt(ano), parseInt(mes), 15);
                            transacoes.push({
                                tipo: 'mensalidade',
                                data: dataPagamento.toISOString().split('T')[0],
                                descricao: `Mensalidade - ${membro.nome}`,
                                valor: parseFloat(valor),
                                categoria: 'Mensalidade',
                                dataObj: dataPagamento,
                                membro: membro.nome
                            });
                        }
                    });
                });
            });
            
            // Ordenar por data (mais recentes primeiro) e pegar as 15 últimas
            transacoes.sort((a, b) => b.dataObj - a.dataObj);
            const ultimas = transacoes.slice(0, 15);
            
            const container = document.getElementById('ultimasTransacoes');
            container.innerHTML = ultimas.map(t => {
                let iconClass, bgClass, textClass, prefix;
                
                if (t.tipo === 'entrada') {
                    iconClass = 'fa-arrow-down';
                    bgClass = 'bg-green-100 text-green-600';
                    textClass = 'text-green-600';
                    prefix = '+';
                } else if (t.tipo === 'saida') {
                    iconClass = 'fa-arrow-up';
                    bgClass = 'bg-red-100 text-red-600';
                    textClass = 'text-red-600';
                    prefix = '-';
                } else {
                    iconClass = 'fa-user-check';
                    bgClass = 'bg-gold-100 text-gold-600';
                    textClass = 'text-gold-600';
                    prefix = '+';
                }
                
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full ${bgClass} flex items-center justify-center flex-shrink-0">
                                <i class="fas ${iconClass}"></i>
                            </div>
                            <div class="min-w-0">
                                <p class="font-medium text-sm text-gray-800 truncate">${t.descricao}</p>
                                <p class="text-xs text-gray-500">${formatarData(t.data)} • ${t.categoria}</p>
                            </div>
                        </div>
                        <span class="font-bold ${textClass} whitespace-nowrap ml-2">
                            ${prefix} ${formatarMoeda(t.valor)}
                        </span>
                    </div>
                `;
            }).join('');
        }

        function desenharGrafico() {
            const canvas = document.getElementById('financeChart');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const hoje = new Date();
            const mesesDados = {};
            
            // Inicializar últimos 6 meses
            for (let i = 5; i >= 0; i--) {
                const d = new Date(hoje.getFullYear(), hoje.getMonth() - i, 1);
                const key = `${d.getFullYear()}-${d.getMonth()}`;
                mesesDados[key] = { 
                    mes: d.getMonth(), 
                    ano: d.getFullYear(),
                    entradas: 0, 
                    saidas: 0,
                    label: meses[d.getMonth()]
                };
            }
            
            // Agrupar entradas
            dados.entradas.forEach(e => {
                const data = new Date(e.data);
                const key = `${data.getFullYear()}-${data.getMonth()}`;
                if (mesesDados[key]) {
                    mesesDados[key].entradas += e.valor;
                }
            });
            
            // Agrupar mensalidades como entradas
            dados.membros.forEach(membro => {
                Object.entries(membro.pagamentos).forEach(([ano, pagamentos]) => {
                    Object.entries(pagamentos).forEach(([mes, valor]) => {
                        if (valor && valor !== 'X') {
                            const key = `${ano}-${mes}`;
                            if (mesesDados[key]) {
                                mesesDados[key].entradas += parseFloat(valor) || 0;
                            }
                        }
                    });
                });
            });
            
            // Agrupar saídas
            dados.saidas.forEach(s => {
                const data = new Date(s.data);
                const key = `${data.getFullYear()}-${data.getMonth()}`;
                if (mesesDados[key]) {
                    mesesDados[key].saidas += s.valor;
                }
            });
            
            const valores = Object.values(mesesDados);
            const maxVal = Math.max(...valores.map(m => Math.max(m.entradas, m.saidas))) || 100;
            const barWidth = width / (valores.length * 3);
            const scale = (height - 40) / maxVal;
            
            valores.forEach((m, index) => {
                const x = index * (barWidth * 3) + 30;
                const entradasH = m.entradas * scale;
                const saidasH = m.saidas * scale;
                
                // Barra entradas
                ctx.fillStyle = '#10b981';
                ctx.fillRect(x, height - entradasH - 20, barWidth - 2, entradasH);
                
                // Barra saídas
                ctx.fillStyle = '#ef4444';
                ctx.fillRect(x + barWidth + 2, height - saidasH - 20, barWidth - 2, saidasH);
                
                // Label mês
                ctx.fillStyle = '#6b7280';
                ctx.font = '11px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(m.label, x + barWidth, height - 5);
            });
        }

        function renderizarMembros() {
            const tbody = document.getElementById('tabelaMembros');
            const isAdmin = usuarioAtual && usuarioAtual.role === 'admin';
            
            tbody.innerHTML = dados.membros.map(membro => {
                const pagamentosAno = membro.pagamentos[anoAtualMembros] || {};
                const total = Object.values(pagamentosAno).reduce((acc, val) => {
                    return acc + (val === 'X' ? 0 : (parseFloat(val) || 0));
                }, 0);
                
                return `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900">${membro.nome}</td>
                        ${meses.map((_, idx) => {
                            const val = pagamentosAno[idx];
                            let display = '';
                            let bgClass = 'bg-gray-50 text-gray-400';
                            
                            if (val === 'X') {
                                display = 'X';
                                bgClass = 'bg-yellow-100 text-yellow-700';
                            } else if (val && val > 0) {
                                display = val;
                                bgClass = 'bg-green-100 text-green-700';
                            }
                            
                            const clickAction = isAdmin ? `onclick="editarPagamento(${membro.id}, ${idx}, ${anoAtualMembros})"` : '';
                            const cursorClass = isAdmin ? 'cursor-pointer hover:opacity-80' : 'cursor-default';
                            
                            return `
                                <td class="px-2 py-4 text-center">
                                    <button ${clickAction} 
                                            class="w-10 h-8 rounded ${bgClass} text-xs font-bold ${cursorClass} transition-opacity"
                                            ${!isAdmin ? 'disabled' : ''}>
                                        ${display || '-'}
                                    </button>
                                </td>
                            `;
                        }).join('')}
                        <td class="px-6 py-4 text-center font-bold text-church-600">${total > 0 ? total : '-'}</td>
                        ${isAdmin ? `
                        <td class="px-6 py-4 text-center">
                            <button onclick="excluirMembro(${membro.id})" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                        ` : '<td class="admin-only hidden"></td>'}
                    </tr>
                `;
            }).join('');
        }

        function renderizarEntradas() {
            const tbody = document.getElementById('tabelaEntradas');
            const isAdmin = usuarioAtual && usuarioAtual.role === 'admin';
            
            const entradasAno = dados.entradas.filter(e => {
                const ano = e.ano || new Date(e.data).getFullYear();
                return ano === anoAtualEntradas;
            });
            
            tbody.innerHTML = entradasAno.sort((a, b) => new Date(b.data) - new Date(a.data)).map(e => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatarData(e.data)}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${e.descricao}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">${e.categoria}</td>
                    <td class="px-6 py-4 text-sm font-bold text-green-600 text-right">${formatarMoeda(e.valor)}</td>
                    ${isAdmin ? `
                    <td class="px-6 py-4 text-center">
                        <button onclick="excluirEntrada(${e.id})" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                    ` : '<td class="admin-only hidden"></td>'}
                </tr>
            `).join('');
            
            const categorias = {};
            entradasAno.forEach(e => {
                categorias[e.categoria] = (categorias[e.categoria] || 0) + e.valor;
            });
            
            const container = document.getElementById('resumoEntradas');
            container.innerHTML = Object.entries(categorias)
                .sort((a, b) => b[1] - a[1])
                .map(([cat, val]) => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-700">${cat}</span>
                        <span class="text-sm font-bold text-green-600">${formatarMoeda(val)}</span>
                    </div>
                `).join('');
        }

        function renderizarSaidas() {
            const tbody = document.getElementById('tabelaSaidas');
            const isAdmin = usuarioAtual && usuarioAtual.role === 'admin';
            
            const saidasAno = dados.saidas.filter(s => {
                const ano = s.ano || new Date(s.data).getFullYear();
                return ano === anoAtualSaidas;
            });
            
            tbody.innerHTML = saidasAno.sort((a, b) => new Date(b.data) - new Date(a.data)).map(s => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatarData(s.data)}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${s.descricao}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">${s.categoria}</td>
                    <td class="px-6 py-4 text-sm font-bold text-red-600 text-right">${formatarMoeda(s.valor)}</td>
                    ${isAdmin ? `
                    <td class="px-6 py-4 text-center">
                        <button onclick="excluirSaida(${s.id})" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                    ` : '<td class="admin-only hidden"></td>'}
                </tr>
            `).join('');
            
            const categorias = {};
            saidasAno.forEach(s => {
                categorias[s.categoria] = (categorias[s.categoria] || 0) + s.valor;
            });
            
            const container = document.getElementById('resumoSaidas');
            container.innerHTML = Object.entries(categorias)
                .sort((a, b) => b[1] - a[1])
                .map(([cat, val]) => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-700">${cat}</span>
                        <span class="text-sm font-bold text-red-600">${formatarMoeda(val)}</span>
                    </div>
                `).join('');
        }

        function renderizarBalanco() {
            const tbody = document.getElementById('tabelaBalanco');
            let saldoAcumulado = dados.saldoInicial;
            
            const balancoMensal = {};
            for (let i = 0; i < 12; i++) {
                balancoMensal[i] = { entradas: 0, saidas: 0 };
            }
            
            // Entradas normais
            dados.entradas.forEach(e => {
                const mes = new Date(e.data).getMonth();
                balancoMensal[mes].entradas += e.valor;
            });
            
            // Mensalidades como entradas
            dados.membros.forEach(membro => {
                Object.entries(membro.pagamentos).forEach(([ano, pagamentos]) => {
                    Object.entries(pagamentos).forEach(([mes, valor]) => {
                        if (valor && valor !== 'X') {
                            balancoMensal[mes].entradas += parseFloat(valor) || 0;
                        }
                    });
                });
            });
            
            dados.saidas.forEach(s => {
                const mes = new Date(s.data).getMonth();
                balancoMensal[mes].saidas += s.valor;
            });
            
            tbody.innerHTML = Object.keys(balancoMensal).map(mes => {
                const { entradas, saidas } = balancoMensal[mes];
                saldoAcumulado += entradas - saidas;
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 font-medium text-gray-900">${meses[mes]}</td>
                        <td class="px-6 py-4 text-right text-green-600 font-medium">${entradas > 0 ? formatarMoeda(entradas) : '-'}</td>
                        <td class="px-6 py-4 text-right text-red-600 font-medium">${saidas > 0 ? formatarMoeda(saidas) : '-'}</td>
                        <td class="px-6 py-4 text-right font-bold ${saldoAcumulado >= 0 ? 'text-church-600' : 'text-red-600'}">${formatarMoeda(saldoAcumulado)}</td>
                    </tr>
                `;
            }).join('');
        }

        function openModal(type) {
            if (!usuarioAtual || usuarioAtual.role !== 'admin') {
                showToast('Apenas administradores podem adicionar registros');
                return;
            }
            
            const modal = document.getElementById('modal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            const hoje = new Date();
            
            if (type === 'membro') {
                title.textContent = 'Novo Membro';
                content.innerHTML = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Membro</label>
                            <input type="text" id="nomeMembro" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-church-500 focus:border-church-500" placeholder="Digite o nome completo">
                        </div>
                        <button onclick="salvarMembro()" class="w-full py-2 bg-church-600 text-white rounded-lg hover:bg-church-700 transition-colors font-medium">
                            Salvar Membro
                        </button>
                    </div>
                `;
            } else if (type === 'entrada') {
                title.textContent = 'Nova Entrada';
                content.innerHTML = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Data</label>
                            <input type="date" id="dataEntrada" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" value="${hoje.toISOString().split('T')[0]}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Descrição</label>
                            <input type="text" id="descEntrada" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="Ex: Coleta, Doação...">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                            <select id="catEntrada" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="Coleta">Coleta</option>
                                <option value="Doação">Doação</option>
                                <option value="Rendimento">Rendimento</option>
                                <option value="Mensalidade">Mensalidade</option>
                                <option value="Outro">Outro</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
                            <input type="number" step="0.01" id="valEntrada" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="0,00">
                        </div>
                        <button onclick="salvarEntrada()" class="w-full py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium">
                            Salvar Entrada
                        </button>
                    </div>
                `;
            } else if (type === 'saida') {
                title.textContent = 'Nova Saída';
                content.innerHTML = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Data</label>
                            <input type="date" id="dataSaida" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500" value="${hoje.toISOString().split('T')[0]}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Descrição</label>
                            <input type="text" id="descSaida" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500" placeholder="Ex: Pagamento, Compra...">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                            <select id="catSaida" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                                <option value="Mensalidade">Mensalidade</option>
                                <option value="Compra">Compra</option>
                                <option value="Doação">Doação</option>
                                <option value="Ajuda">Ajuda</option>
                                <option value="Evento">Evento</option>
                                <option value="Infraestrutura">Infraestrutura</option>
                                <option value="Outro">Outro</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
                            <input type="number" step="0.01" id="valSaida" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500" placeholder="0,00">
                        </div>
                        <button onclick="salvarSaida()" class="w-full py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium">
                            Salvar Saída
                        </button>
                    </div>
                `;
            }
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function salvarMembro() {
            if (!usuarioAtual || usuarioAtual.role !== 'admin') return;
            
            const nome = document.getElementById('nomeMembro').value;
            if (!nome) return alert('Digite o nome do membro');
            
            const novoId = Math.max(...dados.membros.map(m => m.id), 0) + 1;
            dados.membros.push({
                id: novoId,
                nome: nome,
                pagamentos: { 2025: {} }
            });
            
            salvarDados();
            renderizarMembros();
            closeModal();
            showToast('Membro adicionado com sucesso!');
        }

        function salvarEntrada() {
            if (!usuarioAtual || usuarioAtual.role !== 'admin') return;
            
            const data = document.getElementById('dataEntrada').value;
            const descricao = document.getElementById('descEntrada').value;
            const categoria = document.getElementById('catEntrada').value;
            const valor = parseFloat(document.getElementById('valEntrada').value);
            
            if (!data || !descricao || !valor) return alert('Preencha todos os campos');
            
            const novoId = Math.max(...dados.entradas.map(e => e.id), 0) + 1;
            const ano = new Date(data).getFullYear();
            dados.entradas.push({ id: novoId, data, descricao, categoria, valor, ano });
            
            salvarDados();
            renderizarTudo();
            closeModal();
            showToast('Entrada registrada com sucesso!');
        }

        function salvarSaida() {
            if (!usuarioAtual || usuarioAtual.role !== 'admin') return;
            
            const data = document.getElementById('dataSaida').value;
            const descricao = document.getElementById('descSaida').value;
            const categoria = document.getElementById('catSaida').value;
            const valor = parseFloat(document.getElementById('valSaida').value);
            
            if (!data || !descricao || !valor) return alert('Preencha todos os campos');
            
            const novoId = Math.max(...dados.saidas.map(s => s.id), 0) + 1;
            const ano = new Date(data).getFullYear();
            dados.saidas.push({ id: novoId, data, descricao, categoria, valor, ano });
            
            salvarDados();
            renderizarTudo();
            closeModal();
            showToast('Saída registrada com sucesso!');
        }

        function editarPagamento(membroId, mes, ano) {
            if (!usuarioAtual || usuarioAtual.role !== 'admin') {
                showToast('Apenas administradores podem editar pagamentos');
                return;
            }
            
            const membro = dados.membros.find(m => m.id === membroId);
            if (!membro.pagamentos[ano]) {
                membro.pagamentos[ano] = {};
            }
            const valorAtual = membro.pagamentos[ano][mes] || '';
            
            const novoValor = prompt(`Pagamento de ${membro.nome} para ${meses[mes]}/${ano}:`, valorAtual);
            if (novoValor !== null) {
                if (novoValor === '' || novoValor === '0') {
                    delete membro.pagamentos[ano][mes];
                } else {
                    membro.pagamentos[ano][mes] = novoValor === 'X' ? 'X' : parseFloat(novoValor);
                }
                salvarDados();
                renderizarMembros();
                renderizarDashboard();
                showToast('Pagamento atualizado!');
            }
        }

        function excluirMembro(id) {
            if (!usuarioAtual || usuarioAtual.role !== 'admin') return;
            
            if (confirm('Tem certeza que deseja excluir este membro?')) {
                dados.membros = dados.membros.filter(m => m.id !== id);
                salvarDados();
                renderizarMembros();
                showToast('Membro removido!');
            }
        }

        function excluirEntrada(id) {
            if (!usuarioAtual || usuarioAtual.role !== 'admin') return;
            
            if (confirm('Tem certeza que deseja excluir esta entrada?')) {
                dados.entradas = dados.entradas.filter(e => e.id !== id);
                salvarDados();
                renderizarTudo();
                showToast('Entrada removida!');
            }
        }

        function excluirSaida(id) {
            if (!usuarioAtual || usuarioAtual.role !== 'admin') return;
            
            if (confirm('Tem certeza que deseja excluir esta saída?')) {
                dados.saidas = dados.saidas.filter(s => s.id !== id);
                salvarDados();
                renderizarTudo();
                showToast('Saída removida!');
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.remove('translate-y-20');
            setTimeout(() => {
                toast.classList.add('translate-y-20');
            }, 3000);
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }

        function formatarData(dataStr) {
            return new Date(dataStr + 'T12:00:00').toLocaleDateString('pt-BR');
        }

        function backupData() {
            if (!usuarioAtual || usuarioAtual.role !== 'admin') {
                showToast('Apenas administradores podem fazer backup');
                return;
            }
            
            const dataStr = JSON.stringify(dados, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_financeiro_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            showToast('Backup baixado com sucesso!');
        }

        function restoreData(input) {
            if (!usuarioAtual || usuarioAtual.role !== 'admin') {
                showToast('Apenas administradores podem restaurar dados');
                return;
            }
            
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dadosRestaurados = JSON.parse(e.target.result);
                    if (confirm('Isso substituirá todos os dados atuais. Deseja continuar?')) {
                        dados = dadosRestaurados;
                        salvarDados();
                        renderizarTudo();
                        showToast('Dados restaurados com sucesso!');
                    }
                } catch (err) {
                    alert('Erro ao ler arquivo: ' + err.message);
                }
            };
            reader.readAsText(file);
            input.value = '';
        }

        function exportarExcel() {
            let csv = 'Tipo,Data,Descrição,Categoria,Valor\n';
            
            dados.entradas.forEach(e => {
                csv += `Entrada,${e.data},${e.descricao},${e.categoria},${e.valor}\n`;
            });
            
            dados.saidas.forEach(s => {
                csv += `Saída,${s.data},${s.descricao},${s.categoria},${s.valor}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `relatorio_financeiro_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            showToast('Relatório exportado!');
        }

        function exportarPDF() {
            alert('Funcionalidade de PDF será implementada com biblioteca adicional. Por enquanto, use a exportação para Excel ou imprima a página (Ctrl+P).');
        }

        function aplicarFiltro() {
            showToast('Filtro aplicado!');
        }

        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !usuarioAtual && document.getElementById('loginPass') === document.activeElement) {
                fazerLoginAdmin();
            }
        });
    </script>
</body>
</html>